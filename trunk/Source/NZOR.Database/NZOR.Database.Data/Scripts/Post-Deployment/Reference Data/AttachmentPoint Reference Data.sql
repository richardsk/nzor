SET NOCOUNT ON

DECLARE @attPoint TABLE
	(
	AttachmentPointID UNIQUEIDENTIFIER NOT NULL, 
	ProviderID UNIQUEIDENTIFIER NOT NULL, 
	DataSourceID UNIQUEIDENTIFIER NOT NULL, 	
	ProviderRecordID NVARCHAR(1000) NOT NULL,
	ConsensusNameID UNIQUEIDENTIFIER NOT NULL, 
	FullName nvarchar(500) NULL, 
	AddedDate datetime not null,
	AddedBy nvarchar(150) not null,
	ModifiedDate datetime null,
	ModifiedBy nvarchar(150)
	)

INSERT INTO
	@attPoint
VALUES
	('2940B87F-1310-49CA-A7C9-2836D6E5B7A9','D0B0B9FB-BDA0-43A6-9BB2-07B6F3DB2C26','2DD748D7-0CF4-4A74-8E01-3464F688603B','39BECB7F-180A-4415-8684-5EAA441795F0','64977BFD-B255-4686-97F6-75D1F4CDDD11','Asterales',GETDATE(),'system',NULL,NULL),
	('177B74BE-1F7A-47C8-8E91-2FFBDD13D829','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB188FC-36B9-11D5-9548-00D0592D548C','443A81A4-35AD-4B98-A829-D755A6C76027','Fungi Whittaker', getdate(),'system',NULL,NULL),

	('7A741043-75EA-48AA-91AB-609A467BD11E','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CED4-36B9-11D5-9548-00D0592D548C','CB489858-D3AB-41B0-B557-489DE4D5D0C9','Chromista',getdate(), 'system',null,null),
	('892818F7-3253-407E-B1F3-C76799B82001','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CED3-36B9-11D5-9548-00D0592D548C','8DCA8B6A-DA01-4124-888C-5ACA5F3E328C','Protozoa',getdate(), 'system',null,null),
	('C566E8B6-E034-49DA-9473-7DFEA2247F1D','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE08-36B9-11D5-9548-00D0592D548C','69ABB905-7C96-4319-BD00-18ABB9FE9672','Bacteria',getdate(), 'system',null,null),	

	('1B35A46B-5AA4-4635-BFF5-F8F382371730','B8E1EF06-1F7D-43CE-BF30-71735E600A96','F6235951-CA30-4449-87F3-9159BEEBFB24','8AE0A964-A505-4D3B-8E20-E916F9B83E74','D6FB068A-AFDF-4B07-AEF0-E00A51655E12','Plantae', getdate(), 'system', NULL, NULL),
	('EFD28017-8B95-4CAE-AA31-542CD8FA535B','B8E1EF06-1F7D-43CE-BF30-71735E600A96','F6235951-CA30-4449-87F3-9159BEEBFB24','589C1265-2679-4718-8390-65BCAB517B18','69ABB905-7C96-4319-BD00-18ABB9FE9672','Bacteria', getdate(), 'system', NULL, NULL),	

	('A103BECF-9A89-4AFE-B491-F72954BD812A','1D977BFC-E67E-4E70-B4D1-F3AB62572C57','DC793129-7C07-4B4C-B496-B0D9AAE4620F','275B856C-B0A7-4214-A75C-6D28496296F6','7F503B5D-9763-4DC8-BC16-ADEBECEC5E68','Animalia',getdate(), 'system',null,null),

	('D863E6D9-E51E-4561-9FAF-ED7D1E444724','22B420A6-5C18-4CBC-9560-E48B2B24EDFF','144D59E3-C85D-4173-B25A-41EE6008B6C6','417DB677-90E9-45E7-ACAB-5B2297CAA2A0','F38E12BF-0BE7-4F13-B739-E2BC1B763AE0','Animalia',getdate(), 'system',null,null),
	('221CACD5-05C4-48D7-AE5A-0D8C3822C7AF','91cbf580-e513-4ca4-89af-724253a393ac','c93f3e15-92da-4e93-9de0-416f937cc8e5','DA349C8B-F6C8-477D-B07A-AEC8BDFACDF2','F38E12BF-0BE7-4F13-B739-E2BC1B763AE0','Animalia',getdate(), 'system',null,null),

	('BDE85E1B-61C0-4C0B-B6E0-2A35329843A3','91cbf580-e513-4ca4-89af-724253a393ac','c93f3e15-92da-4e93-9de0-416f937cc8e5','A88B4F80-A299-4C9D-96A2-79587C4CF419','69ABB905-7C96-4319-BD00-18ABB9FE9672','Bacteria',getdate(), 'system',null,null),
	('FD9BB745-1426-434D-B822-80D055B3DF36','91cbf580-e513-4ca4-89af-724253a393ac','c93f3e15-92da-4e93-9de0-416f937cc8e5','FCD56DD7-210C-49E3-A151-9A1255ED8472','3EAD4965-50D6-4373-A616-240CC151C611','Plantae',getdate(), 'system',null,null),
	('1F9ACB57-CFB8-442F-9A36-DDE243817ADD','91cbf580-e513-4ca4-89af-724253a393ac','c93f3e15-92da-4e93-9de0-416f937cc8e5','9A817EE5-5F8D-4526-BB51-5B5C4FF60253','CB489858-D3AB-41B0-B557-489DE4D5D0C9','Chromista',getdate(), 'system',null,null),
	('0061160C-CCAF-4F22-95AC-978D641437EC','91cbf580-e513-4ca4-89af-724253a393ac','c93f3e15-92da-4e93-9de0-416f937cc8e5','4FDB7424-4D91-4821-B728-1A66D32E0525','8DCA8B6A-DA01-4124-888C-5ACA5F3E328C','Protozoa',getdate(), 'system',null,null),
	

	-- Lichens, set as fungi att points but plants have priorty (in AttachmentPointDataSource)
	('87E65B48-99CA-4CB8-ABCD-DF7DCDF5EE48','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1C4A9-36B9-11D5-9548-00D0592D548C','04144550-F762-44A3-98D3-EA9327618003','Arthonia Ach.', getdate(), 'system', NULL, NULL),
	('E802932B-B0B0-44ED-986C-E25CAB962492','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE0E-36B9-11D5-9548-00D0592D548C','15AEAFDD-535B-4903-9616-DE4ED211EA6E','Arthoniales Henssen ex D. Hawksw. & O.E. Erikss.', getdate(), 'system', NULL, NULL),
	('C7E41C9A-420C-40CA-836F-BAC9F9D4A398','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE87-36B9-11D5-9548-00D0592D548C','6574A9E3-9E5F-43B4-9D71-1E712C331FFB','Arthrorhaphidaceae Poelt & Hafellner', getdate(), 'system', NULL, NULL),
	('9DFEA65C-7240-47BC-AA18-7F842692E9B1','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','AC9DFD55-2A6D-411E-8507-36F618BDECD6','5E2C5BB1-70B0-469E-A464-5B119C40384B','Aspidotheliaceae Räsänen ex J.C. David & D. Hawksw.', getdate(), 'system', NULL, NULL),
	('909D398C-7012-4735-A76A-314BE122093B','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE14-36B9-11D5-9548-00D0592D548C','06FFE598-7C7F-48BC-B1A8-064509C6317F','Caliciales Bessey', getdate(), 'system', NULL, NULL),
	('DE98D857-4F1D-4358-B79B-05C3814E7AD0','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE9C-36B9-11D5-9548-00D0592D548C','A8C26536-E405-4E2E-A110-0FA9282ECF7C','Chrysothricaceae Zahlbr.', getdate(), 'system', NULL, NULL),
	('46C97DC7-EF57-4B88-A1CA-9B4C208F139D','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','329CEDC2-2D7E-4E75-B04E-387B738C3E03','FF1B2166-62AC-4E00-A8F2-6CBB12555176','Cryptothecia Stirt.', getdate(), 'system', NULL, NULL),
	('D9FCE90A-2C24-416B-BE97-41EADB121330','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','754CFEFB-E708-4AF2-9404-B8B312B05BBE','3E3EA313-D1BA-42D8-BD43-BC7088AC68D6','Graphidaceae Dumort.', getdate(), 'system', NULL, NULL),
	('9C39204A-8584-4AE2-821A-BD406C18F6F2','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE34-36B9-11D5-9548-00D0592D548C','14121793-1DAF-44EC-A8EF-A42CA2F35201','Lecanorales Nannf.', getdate(), 'system', NULL, NULL),
	('8892F139-9D2A-4063-8A9B-B9DFDD9E28E7','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1904C-36B9-11D5-9548-00D0592D548C','C479C437-A27E-40DF-A8ED-959D1A11D8F1','Lepraria Ach.', getdate(), 'system', NULL, NULL),
	('CC60BB37-C82C-436F-9324-010ACA4CE2B1','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','79A06CCC-EA5A-4F90-818F-9697FE688285','C4DD7E24-E1C1-4982-B3B7-74C535CE269A','Massalongia Körb.', getdate(), 'system', NULL, NULL),
	('962DE68D-A6C8-4D37-9615-C7A49CDA1C73','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CD61-36B9-11D5-9548-00D0592D548C','10F169F6-70F6-48C2-94F7-23C0115C43DA','Melaspileaceae Walt. Watson', getdate(), 'system', NULL, NULL),
	('29F36F1F-2D13-436A-85E4-EC8099423D03','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','07665031-8D4B-4A0A-934F-5CB9E3D9CD84','00B119E9-DD62-44DA-8822-02FE1372B0EE','Normandina Nyl.', getdate(), 'system', NULL, NULL),
	('9024FAED-671E-49FA-BD4D-93A883F55690','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','5F62A89B-84F7-454D-9B65-2B650AB89115','B969C733-C650-4D57-952F-7DCD47C00047','Peltigeraceae Dumort.', getdate(), 'system', NULL, NULL),
	('C8EE52C8-1712-419F-92D5-B3D633F690CF','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE44-36B9-11D5-9548-00D0592D548C','BDABF285-D123-44C8-A296-56D9EE5C8BBE','Peltigerales W. Watson', getdate(), 'system', NULL, NULL),
	('0033A7D1-9C97-4359-B8E1-239116D99D03','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE74-36B9-11D5-9548-00D0592D548C','A875BD65-6AF8-4A8A-A1FC-9A4E957BF5AF','Pertusariales M. Choisy ex D. Hawksw. & O.E. Erikss.', getdate(), 'system', NULL, NULL),
	('1F7F1126-7F5D-40A4-A1BA-92D81E7DF04B','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','86242930-9544-47E4-8C97-C3D8AD5233DB','DE7CC4C0-FBD2-44FF-8FAA-065E2CC1AFCC','Phlyctidaceae Poelt ex J.C. David & D. Hawksw.', getdate(), 'system', NULL, NULL),
	('2D1D8AF0-47D2-4CB0-8133-94E50C8CF709','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','4E06E66C-300E-4C86-BE1B-48BAA2AAAEBA','41E6DAD7-FA6D-41F5-91CF-64FA58A376E3','Podotara Malcolm & Vězda', getdate(), 'system', NULL, NULL),
	('18364DB7-5708-4A1C-8774-4B0A8AB9D1FE','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','3476A95B-5918-4EF8-8869-B11D62CF86FD','D598D09A-5B3A-4054-B64A-0E94B8673A77','Porina Ach.', getdate(), 'system', NULL, NULL),
	('2A3BC999-5A15-4E0C-A339-012294C3CCDF','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE4F-36B9-11D5-9548-00D0592D548C','1445F642-E3A1-4ACB-AD5B-6243BF09CC8C','Pyrenulales Fink ex D. Hawksw. & O.E. Erikss.', getdate(), 'system', NULL, NULL),
	('A46D4C53-F996-423A-89A4-36A69EE8F25F','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CDBF-36B9-11D5-9548-00D0592D548C','10F30D7C-718D-4C11-8814-B25544D7B6E3','Roccellaceae Chevall.', getdate(), 'system', NULL, NULL),
	('8963DEAA-54F9-49C3-9BAD-FF85F1B156BB','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CDDE-36B9-11D5-9548-00D0592D548C','2F8F3A75-72A3-4636-8321-638BBE649F51','Strigulaceae Zahlbr.', getdate(), 'system', NULL, NULL),
	('C4B72842-5C23-4AF3-928E-77BDB7638FD8','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1CE79-36B9-11D5-9548-00D0592D548C','1B5B4AE4-4134-4FC6-925F-EA0E876B512B','Teloschistales D. Hawksw. & O.E. Erikss.', getdate(), 'system', NULL, NULL),
	('EEFC8218-863F-4D68-9DB8-D9EFAA57EB2B','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','D27F5669-7B94-41C5-BB8C-AFA6535C5475','B88CC149-2155-45A7-A0A0-7EE5EE7CC37F','Thelenellaceae H. Mayrhofer', getdate(), 'system', NULL, NULL),
	('2C48F5B8-4C98-44E6-AD71-5A7DFDD44B81','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','1CB1A6F3-36B9-11D5-9548-00D0592D548C','3166925D-BA39-43C0-8E60-2588C4B477FF','Thelotremataceae Stizenb.', getdate(), 'system', NULL, NULL),
	('92154CB5-206B-4033-8860-C1F60EBCBE28','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','2B79B9FC-30BD-45DD-978D-2970FD8D9DEB','3B6F2362-6D72-4EEB-B4D2-B394B8D9CDAD','Thrombiaceae Poelt & Vězda ex J.C. David & D. Hawksw.', getdate(), 'system', NULL, NULL),
	('2E648CBF-36EE-406B-86D5-E1B46EED8C0C','E4E30DC8-C708-445F-86C3-235E0028F129','175D49CD-0785-4008-BB56-04DF3E46DE13','6BE62FC2-BF52-4362-9357-03B93B5AF1ED','90F665B4-D0FB-4557-8405-745DD50035C2','Trichotheliales Hafellner & Kalb', getdate(), 'system', NULL, NULL)

MERGE 
    [admin].AttachmentPoint AS Target
USING 
    @attPoint AS Source 
ON 
    (Target.AttachmentPointID = Source.AttachmentPointID)
WHEN MATCHED 
    THEN UPDATE
        SET   
			Target.ProviderID = Source.ProviderID,
			Target.DataSourceID = Source.DataSourceID,
			Target.ProviderRecordID = Source.ProviderRecordID,
			Target.ConsensusNameID = Source.ConsensusNameID,
			Target.FullName = Source.FullName,
			Target.AddedDate = Source.AddedDate,
			Target.AddedBy = Source.AddedBy,
			Target.ModifiedDate = Source.ModifiedDate,
			Target.ModifiedBy = Source.ModifiedBy

WHEN NOT MATCHED BY TARGET 
    THEN INSERT      
        (AttachmentPointID,ProviderID,DataSourceID,ProviderRecordID,ConsensusNameID,FullName,AddedDate,AddedBy,ModifiedDate,ModifiedBy)
    VALUES      
		(AttachmentPointID,ProviderID,DataSourceID,ProviderRecordID,ConsensusNameID,FullName,AddedDate,AddedBy,ModifiedDate,ModifiedBy)

WHEN NOT MATCHED BY SOURCE 
    THEN DELETE
; 

go